<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PawCare - Search Services</title>
  <meta name="organization" content="CLEMS">
  <meta name="author" content="CLEMS">
  <meta name="designer" content="CLEMS">
  <meta name="copyright" content="© 2025 CLEMS. All rights reserved">
  <link rel="stylesheet" href="/src/styles/globals.css">
  <link rel="stylesheet" href="/src/styles/search.css">
</head>

<body>
  <!-- Header -->
  <header class="header">
    <div class="logo" onclick="navigateToHome()" style="cursor: pointer;">
      <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 2C13.1 2 14 2.9 14 4S13.1 6 12 6 10 5.1 10 4 10.9 2 12 2M8.5 7C9.6 7 10.5 7.9 10.5 9S9.6 11 8.5 11 6.5 10.1 6.5 9 7.4 7 8.5 7M15.5 7C16.6 7 17.5 7.9 17.5 9S16.6 11 15.5 11 13.5 10.1 13.5 9 14.4 7 15.5 7M12 8C15.31 8 18 10.69 18 14V22H6V14C6 10.69 8.69 8 12 8Z' fill='%234a5568'/%3E%3C/svg%3E"
        alt="PawCare Logo" class="logo-icon">
      <span class="logo-text">PawCare</span>
    </div>

    <!-- Filtro de departamentos -->
    <nav class="nav">
      <div class="nav-item">
        <label for="departmentsSelect">Departamento:</label>
        <select id="departmentsSelect" class="select-filter">
          <option value="">Seleccione un departamento</option>
        </select>
      </div>
    </nav>

    <button class="search-btn" id="searchBtn">Search</button>
  </header>

  <!-- Main Content -->
  <main class="main">
    <!-- Content Area -->
    <div class="content" id="servicesContent">
      <div class="loading">Seleccione un departamento para ver servicios...</div>
      <div id="results"></div>
    </div>
  </main>

  <!-- Back to Start Button -->
  <a href="/src/pages/profile.html"><button class="back-to-start">Go back</button></a>

  <script type="module">
    const select = document.getElementById("departmentsSelect");
    const results = document.getElementById("results");
    const loading = document.querySelector(".loading");
    const searchBtn = document.getElementById("searchBtn");

    // Cargar departamentos desde la API
    async function loadDepartments() {
      try {
        const res = await fetch("http://localhost:3000/departments");
        const data = await res.json();

        // Suponiendo que el array viene así: [{ name: "Atlántico" }, { name: "Bolívar" }]
        data.forEach(dep => {
          const option = document.createElement("option");
          option.value = dep.name;
          option.textContent = dep.name;
          select.appendChild(option);
        });
      } catch (error) {
        console.error("Error al cargar departamentos:", error);
      }
    }

    // Buscar servicios filtrados por departamento
    searchBtn.addEventListener("click", async () => {
      const department = select.value;
      if (!department) {
        results.innerHTML = "<p>⚠️ Selecciona un departamento primero</p>";
        return;
      }

      loading.textContent = "Buscando servicios...";

      try {
        // Aquí podrías hacer otra petición a tu API, ejemplo:
        // const res = await fetch(`http://localhost:3000/services?department=${department}`);
        // const services = await res.json();

        // De momento simulo resultados:
        results.innerHTML = `
          <div class="service-card">
            <h3>Servicios en ${department}</h3>
            <p>Aquí aparecerán los resultados de la API de servicios filtrados.</p>
          </div>
        `;
        loading.textContent = "";
      } catch (error) {
        console.error("Error al buscar servicios:", error);
        results.innerHTML = "<p>❌ Error al cargar los servicios.</p>";
      }
    });

    // Inicializar
    loadDepartments();
  </script>
</body>
</html>
